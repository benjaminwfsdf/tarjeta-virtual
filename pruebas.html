<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Pong Gold - 2 Jugadores (Vertical)</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
    html,body{width:100%;height:100%;overflow:hidden;background:#000;color:#FFD700;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{display:flex;flex-direction:column;align-items:center;gap:8px;
         padding:env(safe-area-inset-top) 10px env(safe-area-inset-bottom)}
    .container{width:100%;max-width:800px;height:100dvh;display:flex;flex-direction:column;gap:8px;justify-content:space-between}
    .header{width:100%;text-align:center;padding:6px 10px}
    h1{font-size:2rem;background:linear-gradient(45deg,#FFD700,#FFA500);
       -webkit-background-clip:text;-webkit-text-fill-color:transparent;
       text-shadow:0 0 15px rgba(255,215,0,.5)}
    .subtitle{font-size:.9rem;color:#b8860b}
    .score-board{display:flex;justify-content:space-between;gap:10px;align-items:center;width:100%;
                 background:linear-gradient(135deg,#1a1a1a,#000);padding:8px 12px;border-radius:10px;border:2px solid #FFD700;
                 font-size:1rem;font-weight:bold}
    .player-score{display:flex;flex-direction:column;align-items:center}
    .score-label{font-size:.8rem;color:#b8860b;margin-bottom:2px}
    .score-value{font-size:1.4rem;color:#FFD700}
    .game-area{flex:1;position:relative;display:flex;flex-direction:column;gap:6px}
    canvas{width:100%;height:100%;border:2px solid #FFD700;border-radius:10px;background:#000;display:block}
    .controls-row{display:flex;justify-content:space-between;gap:10px;width:100%}
    .player-controls{display:flex;flex-direction:column;align-items:center;flex:1}
    .control-label{font-size:.8rem;color:#b8860b;margin-bottom:4px;text-align:center}
    .arrows{display:flex;gap:8px}
    .arrow-btn{width:58px;height:58px;background:linear-gradient(135deg,#1a1a1a,#000);
               border:2px solid #FFD700;border-radius:12px;display:flex;align-items:center;justify-content:center;
               font-size:1.3rem;color:#FFD700;touch-action:none}
    .arrow-btn:active{background:linear-gradient(135deg,#FFD700,#b8860b);color:#000}
    .controls{display:flex;gap:8px;width:100%}
    .btn{flex:1;background:linear-gradient(135deg,#FFD700,#b8860b);border:none;color:#000;
         padding:10px 6px;font-size:.95rem;font-weight:bold;border-radius:8px;cursor:pointer;min-height:46px;
         display:flex;align-items:center;justify-content:center;gap:6px}
    .btn:active{transform:scale(.98)}
    .game-over{position:absolute;inset:0;display:none;place-items:center;z-index:100}
    .game-over .panel{background:rgba(0,0,0,.95);padding:18px 16px;border-radius:14px;border:2px solid #FFD700;
                      text-align:center;width:90%;max-width:320px}
    .game-over h2{font-size:1.3rem;margin-bottom:10px;color:#FFD700}
    .winner{font-size:1.05rem;margin-bottom:12px;color:#FFD700}
    .particles{position:fixed;inset:0;pointer-events:none;z-index:-1}
    .particle{position:absolute;background:#FFD700;border-radius:50%;opacity:.3;animation:float 15s infinite linear}
    @keyframes float{0%{transform:translateY(100vh) rotate(0)}100%{transform:translateY(-100px) rotate(360deg)}}
    @media (max-height:740px){.arrow-btn{width:52px;height:52px;font-size:1.15rem}.btn{min-height:42px;font-size:.9rem}h1{font-size:1.7rem}}
    @media (max-height:620px){.arrow-btn{width:46px;height:46px;font-size:1.05rem}.score-value{font-size:1.2rem}}
  </style>
</head>
<body oncontextmenu="return false">
  <div class="particles" id="particles"></div>

  <div class="container">
    <div class="header">
      <h1>PONG 2 JUGADORES</h1>
      <p class="subtitle">Vertical: paleta ARRIBA vs paleta ABAJO • toca flechas o el área de juego para empezar</p>
    </div>

    <div class="score-board">
      <div class="player-score">
        <div class="score-label">JUGADOR 1 (Arriba)</div>
        <div class="score-value" id="player1-score">0</div>
      </div>
      <div class="player-score">
        <div class="score-label">JUGADOR 2 (Abajo)</div>
        <div class="score-value" id="player2-score">0</div>
      </div>
    </div>

    <!-- Controles J1 (ARRIBA) -->
    <div class="controls-row">
      <div class="player-controls">
        <div class="control-label">JUGADOR 1</div>
        <div class="arrows">
          <button class="arrow-btn" id="p1-left"  aria-label="J1 Izquierda"><i class="fas fa-arrow-left"></i></button>
          <button class="arrow-btn" id="p1-right" aria-label="J1 Derecha"><i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </div>

    <div class="game-area">
      <canvas id="pongCanvas"></canvas>

      <div class="game-over" id="gameOver">
        <div class="panel">
          <h2>JUEGO TERMINADO</h2>
          <div class="winner" id="winnerMessage"></div>
          <button class="btn" id="restartButton"><i class="fas fa-redo"></i> JUGAR DE NUEVO</button>
        </div>
      </div>
    </div>

    <!-- Controles J2 (ABAJO) -->
    <div class="controls-row">
      <div class="player-controls">
        <div class="control-label">JUGADOR 2</div>
        <div class="arrows">
          <button class="arrow-btn" id="p2-left"  aria-label="J2 Izquierda"><i class="fas fa-arrow-left"></i></button>
          <button class="arrow-btn" id="p2-right" aria-label="J2 Derecha"><i class="fas fa-arrow-right"></i></button>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="startButton"><i class="fas fa-play"></i> INICIAR</button>
      <button class="btn" id="pauseButton"><i class="fas fa-pause"></i> PAUSAR</button>
      <button class="btn" id="resetButton"><i class="fas fa-undo"></i> REINICIAR</button>
    </div>
  </div>

  <script>
    /* ===== Partículas ===== */
    function createParticles(){
      const c=document.getElementById('particles'); const n=12;
      for(let i=0;i<n;i++){
        const p=document.createElement('div'); p.className='particle';
        const size=Math.random()*3+2;
        p.style.width=`${size}px`; p.style.height=`${size}px`;
        p.style.left=`${Math.random()*100}vw`;
        p.style.animationDelay=`${Math.random()*15}s`;
        p.style.animationDuration=`${15+Math.random()*10}s`;
        c.appendChild(p);
      }
    }

    /* ===== DOM ===== */
    const canvas=document.getElementById('pongCanvas');
    const ctx=canvas.getContext('2d');
    const s1=document.getElementById('player1-score');
    const s2=document.getElementById('player2-score');
    const startBtn=document.getElementById('startButton');
    const pauseBtn=document.getElementById('pauseButton');
    const resetBtn=document.getElementById('resetButton');
    const gameOver=document.getElementById('gameOver');
    const winnerMsg=document.getElementById('winnerMessage');
    const restartBtn=document.getElementById('restartButton');
    const p1Left=document.getElementById('p1-left');
    const p1Right=document.getElementById('p1-right');
    const p2Left=document.getElementById('p2-left');
    const p2Right=document.getElementById('p2-right');

    /* ===== Estado ===== */
    let p1Score=0, p2Score=0;
    let running=false, paused=false, animId;
    const winningScore=5;

    const paddleHeight=12;
    let paddleWidth=120;
    const paddleSpeed=9;
    const ballSize=12;

    let p1X, p2X;
    let ballX, ballY, vX, vY;
    let initialized=false;

    const controls={ p1:{left:false,right:false}, p2:{left:false,right:false} };

    function resizeCanvas(){
      const area=canvas.parentElement;
      const w=area.clientWidth;
      const h=Math.min(window.innerHeight*0.60, w*1.2);
      canvas.width=w; canvas.height=h;
      paddleWidth=Math.max(90, Math.min(w*0.35, 160));
      if(initialized){
        p1X=Math.max(0, Math.min(p1X, canvas.width-paddleWidth));
        p2X=Math.max(0, Math.min(p2X, canvas.width-paddleWidth));
        ballX=Math.max(0, Math.min(ballX, canvas.width-ballSize));
        ballY=Math.max(0, Math.min(ballY, canvas.height-ballSize));
        draw();
      }
    }

    function initGame(){
      p1X = canvas.width/2 - paddleWidth/2;
      p2X = canvas.width/2 - paddleWidth/2;
      resetBall(true);
      gameOver.style.display='none';
      paused=false;
      pauseBtn.innerHTML='<i class="fas fa-pause"></i> PAUSAR';
      initialized=true;
      draw();
    }

    function resetBall(first=false){
      ballX = canvas.width/2 - ballSize/2;
      ballY = canvas.height/2 - ballSize/2;
      const dirY = (Math.random()>0.5?1:-1);
      vY = dirY * (first ? 5 : (5 + Math.random()*1.5));
      vX = (Math.random()*2 - 1) * 3.2;
    }

    function startGame(){
      if(!running){
        if(!initialized) initGame();
        running=true; paused=false;
        loop();
      }
    }
    function togglePause(){
      if(!running) return;
      paused=!paused;
      pauseBtn.innerHTML = paused ? '<i class="fas fa-play"></i> REANUDAR'
                                  : '<i class="fas fa-pause"></i> PAUSAR';
      if(!paused) loop();
    }
    function resetGame(){
      p1Score=0; p2Score=0; updateScore();
      running=false; if(animId) cancelAnimationFrame(animId);
      initGame();
    }
    function restartGame(){ resetGame(); startGame(); }

    function updateScore(){
      s1.textContent=p1Score; s2.textContent=p2Score;
      if(p1Score>=winningScore || p2Score>=winningScore){
        running=false; if(animId) cancelAnimationFrame(animId);
        winnerMsg.textContent = p1Score>=winningScore ? '¡JUGADOR 1 GANA!' : '¡JUGADOR 2 GANA!';
        winnerMsg.style.color='#FFD700';
        gameOver.style.display='grid';
      }
    }

    function loop(){
      if(!running || paused) return;
      update(); draw();
      animId=requestAnimationFrame(loop);
    }

    function update(){
      if(!initialized) return;
      if(controls.p1.left)  p1X=Math.max(0, p1X - paddleSpeed);
      if(controls.p1.right) p1X=Math.min(canvas.width-paddleWidth, p1X + paddleSpeed);
      if(controls.p2.left)  p2X=Math.max(0, p2X - paddleSpeed);
      if(controls.p2.right) p2X=Math.min(canvas.width-paddleWidth, p2X + paddleSpeed);

      ballX += vX; ballY += vY;

      if(ballX <= 0){ ballX=0; vX = Math.abs(vX); }
      if(ballX >= canvas.width - ballSize){ ballX = canvas.width - ballSize; vX = -Math.abs(vX); }

      if(ballY <= paddleHeight){
        if(ballX + ballSize > p1X && ballX < p1X + paddleWidth){
          ballY = paddleHeight; vY = Math.abs(vY);
          const hit = ((ballX + ballSize/2) - (p1X + paddleWidth/2)) / (paddleWidth/2);
          vX = hit * 5.5;
        }
      }
      if(ballY + ballSize >= canvas.height - paddleHeight){
        if(ballX + ballSize > p2X && ballX < p2X + paddleWidth){
          ballY = canvas.height - paddleHeight - ballSize; vY = -Math.abs(vY);
          const hit = ((ballX + ballSize/2) - (p2X + paddleWidth/2)) / (paddleWidth/2);
          vX = hit * 5.5;
        }
      }

      if(ballY < -20){ p2Score++; updateScore(); resetBall(); }
      if(ballY > canvas.height+20){ p1Score++; updateScore(); resetBall(); }
    }

    function draw(){
      ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.setLineDash([6,10]); ctx.beginPath();
      ctx.moveTo(0, canvas.height/2); ctx.lineTo(canvas.width, canvas.height/2);
      ctx.strokeStyle='#FFD700'; ctx.lineWidth=2; ctx.stroke(); ctx.setLineDash([]);

      if(!initialized) return;

      const g1=ctx.createLinearGradient(p1X,0,p1X, paddleHeight);
      g1.addColorStop(0,'#FFD700'); g1.addColorStop(1,'#b8860b');
      ctx.fillStyle=g1; ctx.fillRect(p1X, 0, paddleWidth, paddleHeight);

      const g2=ctx.createLinearGradient(p2X, canvas.height-paddleHeight, p2X, canvas.height);
      g2.addColorStop(0,'#b8860b'); g2.addColorStop(1,'#8B6914');
      ctx.fillStyle=g2; ctx.fillRect(p2X, canvas.height - paddleHeight, paddleWidth, paddleHeight);

      const cx = ballX + ballSize/2, cy = ballY + ballSize/2, r = ballSize/2;
      const gb = ctx.createRadialGradient(cx,cy,0,cx,cy,r);
      gb.addColorStop(0,'#FFF'); gb.addColorStop(0.7,'#FFD700'); gb.addColorStop(1,'#b8860b');
      ctx.fillStyle=gb; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill();

      if(paused){
        ctx.fillStyle='rgba(0,0,0,.75)'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle='#FFD700'; ctx.font='bold 22px Arial'; ctx.textAlign='center';
        ctx.fillText('PAUSADO', canvas.width/2, canvas.height/2);
      }
    }

    /* ===== Controles (multitouch con Pointer Events) ===== */
    function bindPress(btn, on, off){
      btn.addEventListener('pointerdown', e=>{
        e.preventDefault(); btn.setPointerCapture(e.pointerId);
        on(); if(!running) startGame();                 // <-- auto-inicio al tocar flecha
      });
      btn.addEventListener('pointerup',   ()=>off());
      btn.addEventListener('pointercancel',()=>off());
      btn.addEventListener('lostpointercapture',()=>off());
    }
    bindPress(p1Left,  ()=>controls.p1.left=true,   ()=>controls.p1.left=false);
    bindPress(p1Right, ()=>controls.p1.right=true,  ()=>controls.p1.right=false);
    bindPress(p2Left,  ()=>controls.p2.left=true,   ()=>controls.p2.left=false);
    bindPress(p2Right, ()=>controls.p2.right=true,  ()=>controls.p2.right=false);

    // Teclado (PC): J1 = A/D, J2 = ←/→, espacio = pausar
    document.addEventListener('keydown',(e)=>{
      if(e.repeat) return;
      if(e.key==='a'||e.key==='A'){controls.p1.left=true; if(!running) startGame();}
      if(e.key==='d'||e.key==='D'){controls.p1.right=true; if(!running) startGame();}
      if(e.key==='ArrowLeft'){controls.p2.left=true; if(!running) startGame();}
      if(e.key==='ArrowRight'){controls.p2.right=true; if(!running) startGame();}
      if(e.key===' '){e.preventDefault(); togglePause();}
    });
    document.addEventListener('keyup',(e)=>{
      if(e.key==='a'||e.key==='A') controls.p1.left=false;
      if(e.key==='d'||e.key==='D') controls.p1.right=false;
      if(e.key==='ArrowLeft') controls.p2.left=false;
      if(e.key==='ArrowRight') controls.p2.right=false;
    });

    // Botones juego
    startBtn.addEventListener('click', ()=>{startGame(); startBtn.blur();});
    pauseBtn.addEventListener('click', ()=>{togglePause(); pauseBtn.blur();});
    resetBtn.addEventListener('click',  ()=>{resetGame(); resetBtn.blur();});
    restartBtn.addEventListener('click',()=>{restartGame(); restartBtn.blur();});

    // Tap en el área de juego también inicia
    canvas.addEventListener('pointerdown', ()=>{ if(!running) startGame(); });

    // Evitar scroll accidental
    document.addEventListener('touchstart',(e)=>{
      const t=e.target;
      if(t.classList.contains('arrow-btn')||t.classList.contains('btn')) e.preventDefault();
    }, {passive:false});

    /* ===== Inicio ===== */
    window.addEventListener('load', ()=>{
      createParticles();
      resizeCanvas();
      initGame();
      startGame(); // <-- inicio automático al cargar
    });
    window.addEventListener('resize', resizeCanvas);
  </script>
</body>
</html>